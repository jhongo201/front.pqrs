<app-header-dashboard></app-header-dashboard>
<ng-container *ngIf="isExternalUser">
  <app-public-header></app-public-header>

  <!-- Hero Header Mejorado -->
  <div class="hero-header">
    <div class="hero-content">
      <div class="hero-main">
        <div class="icon-badge">
          <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
            <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6z"/>
          </svg>
        </div>
        <div class="hero-text">
          <h1>Registro de Usuario</h1>
          <p>Complete el formulario para registrarse en el sistema Soporte</p>
        </div>
      </div>
      
      <!-- Progress Steps -->
      <div class="progress-steps">
        <div class="step active">
          <div class="step-number">1</div>
          <span>Información Personal</span>
        </div>
        <div class="step-line"></div>
        <div class="step active">
          <div class="step-number">2</div>
          <span>Datos de Contacto</span>
        </div>
        <div class="step-line"></div>
        <div class="step">
          <div class="step-number">3</div>
          <span>Confirmación</span>
        </div>
      </div>
    </div>
  </div>

  <!-- formulario de registro -->
  <div class="create-user-container">
    <!-- Alert Messages -->
    <div *ngIf="errorMessage" class="alert alert-error">
      <div class="alert-icon">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="alert-content">
        <h4>Error en el formulario</h4>
        <p>{{ errorMessage }}</p>
      </div>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
      <div class="alert-icon">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="alert-content">
        <h4>¡Registro exitoso!</h4>
        <p>{{ successMessage }}</p>
      </div>
    </div>

    <!-- Main Form Card -->
    <div class="form-card">
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
        
        <!-- Sección 1: Información Personal -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div class="section-title">
              <h3>Información Personal</h3>
              <p>Proporcione sus datos personales para el registro</p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="primerNombre" class="form-label">
                <span>Primer Nombre</span>
                <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <input 
                  type="text" 
                  id="primerNombre" 
                  formControlName="primerNombre"
                  class="form-input"
                  placeholder="Ingrese su primer nombre"
                  [class.error]="isFieldInvalid('primerNombre')">
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('primerNombre')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('primerNombre') }}
              </div>
            </div>

            <div class="form-group">
              <label for="otrosNombres" class="form-label">
                <span>Otros Nombres</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <input 
                  type="text" 
                  id="otrosNombres" 
                  formControlName="otrosNombres"
                  class="form-input"
                  placeholder="Ingrese otros nombres (opcional)"
                  [class.error]="isFieldInvalid('otrosNombres')">
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('otrosNombres')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('otrosNombres') }}
              </div>
            </div>

            <div class="form-group">
              <label for="primerApellido" class="form-label">
                <span>Primer Apellido</span>
                <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <input 
                  type="text" 
                  id="primerApellido" 
                  formControlName="primerApellido"
                  class="form-input"
                  placeholder="Ingrese su primer apellido"
                  [class.error]="isFieldInvalid('primerApellido')">
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('primerApellido')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('primerApellido') }}
              </div>
            </div>

            <div class="form-group">
              <label for="segundoApellido" class="form-label">
                <span>Segundo Apellido</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <input 
                  type="text" 
                  id="segundoApellido" 
                  formControlName="segundoApellido"
                  class="form-input"
                  placeholder="Ingrese su segundo apellido (opcional)"
                  [class.error]="isFieldInvalid('segundoApellido')">
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('segundoApellido')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('segundoApellido') }}
              </div>
            </div>

            <div class="form-group">
              <label for="tipoDocumento" class="form-label">
                <span>Tipo de Documento</span>
                <span class="required">*</span>
              </label>
              <div class="select-wrapper">
                <select 
                  id="tipoDocumento" 
                  formControlName="tipoDocumento"
                  class="form-select"
                  [class.error]="isFieldInvalid('tipoDocumento')">
                  <option value="">Seleccione tipo de documento</option>
                  <option *ngFor="let tipo of tiposDocumento" [value]="tipo.codigo">
                    {{ tipo.nombre }}
                  </option>
                </select>
                <div class="select-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('tipoDocumento')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('tipoDocumento') }}
              </div>
            </div>

            <div class="form-group">
              <label for="numeroDocumento" class="form-label">
                <span>Número de Documento</span>
                <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <input 
                  type="text" 
                  id="numeroDocumento" 
                  formControlName="numeroDocumento"
                  class="form-input"
                  placeholder="Número de documento"
                  [class.error]="isFieldInvalid('numeroDocumento')">
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('numeroDocumento')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('numeroDocumento') }}
              </div>
            </div>

            <div class="form-group">
              <label for="departamento" class="form-label">
                <span>Departamento</span>
                <span class="required">*</span>
              </label>
              <div class="select-wrapper">
                <select 
                  id="departamento" 
                  formControlName="departamento"
                  class="form-select"
                  (change)="onDepartamentoChange($event)"
                  [class.error]="isFieldInvalid('departamento')">
                  <option value="">Seleccione departamento</option>
                  <option *ngFor="let depto of departamentos" [value]="depto.codigoDane">
                    {{ depto.nombre }}
                  </option>
                </select>
                <div class="select-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('departamento')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('departamento') }}
              </div>
            </div>

            <div class="form-group">
              <label for="idMunicipio" class="form-label">
                <span>Municipio</span>
                <span class="required">*</span>
              </label>
              <div class="select-wrapper">
                <select 
                  id="idMunicipio" 
                  formControlName="idMunicipio"
                  class="form-select"
                  [disabled]="!municipios.length"
                  [class.error]="isFieldInvalid('idMunicipio')"
                  (change)="onMunicipioChange($event)">
                  <option value="">{{ municipios.length ? 'Seleccione municipio' : 'Primero seleccione un departamento' }}</option>
                  <option *ngFor="let municipio of municipios" [value]="municipio.id">
                    {{ municipio.nombre }}
                  </option>
                </select>
                <div class="select-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('idMunicipio')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('idMunicipio') }}
              </div>
            </div>
          </div>
        </div>

        <!-- Sección 2: Información de Contacto -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
              </svg>
            </div>
            <div class="section-title">
              <h3>Información de Contacto</h3>
              <p>Datos para notificaciones y comunicación</p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="email" class="form-label">
                <span>Correo Electrónico</span>
                <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                  </svg>
                </div>
                <input 
                  type="email" 
                  id="email" 
                  formControlName="email"
                  class="form-input"
                  placeholder="correo@ejemplo.com"
                  [class.error]="isFieldInvalid('email')">
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('email')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('email') }}
              </div>
            </div>

            <div class="form-group">
              <label for="telefono" class="form-label">
                <span>Teléfono</span>
                <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                  </svg>
                </div>
                <input 
                  type="tel" 
                  id="telefono" 
                  formControlName="telefono"
                  class="form-input"
                  placeholder="3001234567"
                  [class.error]="isFieldInvalid('telefono')">
              </div>
              <div class="input-help">
                {{ userForm.get('telefono')?.value?.length || 0 }}/10 dígitos
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('telefono')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('telefono') }}
              </div>
            </div>
          </div>
        </div>

        <!-- Sección 3: Información de Acceso -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div class="section-title">
              <h3>Información de Acceso</h3>
              <p>Credenciales para ingresar al sistema</p>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="username" class="form-label">
                <span>Nombre de Usuario</span>
                <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <input 
                  type="text" 
                  id="username" 
                  formControlName="username"
                  class="form-input"
                  placeholder="Nombre de usuario único"
                  [class.error]="isFieldInvalid('username')">
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('username')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('username') }}
              </div>
            </div>

            <div class="form-group">
              <label for="password" class="form-label">
                <span>Contraseña</span>
                <span class="required">*</span>
              </label>
              <div class="input-wrapper">
                <div class="input-icon">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                  </svg>
                </div>
                <input 
                  [type]="showPassword ? 'text' : 'password'"
                  id="password" 
                  formControlName="password"
                  class="form-input"
                  placeholder="Contraseña segura"
                  [class.error]="isFieldInvalid('password')">
                <button 
                  type="button" 
                  class="password-toggle" 
                  (click)="togglePasswordVisibility()">
                  <svg *ngIf="!showPassword" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                  <svg *ngIf="showPassword" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L12 12m0 0l3.12 3.12m0 0l3 3"/>
                  </svg>
                </button>
              </div>
              <div class="error-message" *ngIf="isFieldInvalid('password')">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ getErrorMessage('password') }}
              </div>

              <!-- Password Strength Indicator -->
              <div class="password-strength" *ngIf="userForm.get('password')?.touched">
                <div class="strength-item" [class.valid]="passwordMeetsLength">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span>Mínimo 8 caracteres</span>
                </div>
                <div class="strength-item" [class.valid]="passwordHasUpper">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span>Una mayúscula</span>
                </div>
                <div class="strength-item" [class.valid]="passwordHasLower">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span>Una minúscula</span>
                </div>
                <div class="strength-item" [class.valid]="passwordHasNumber">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span>Un número</span>
                </div>
                <div class="strength-item" [class.valid]="passwordHasSpecial">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span>Un carácter especial</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <div class="action-buttons">
            <button type="button" class="btn btn-secondary" (click)="volver()">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
              Cancelar
            </button>
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="userForm.invalid || loading"
              [class.loading]="loading">
              <svg *ngIf="!loading" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>Recibirá un correo de confirmación</span>
            </button>
            <div class="info-item">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
              </svg>
              <span>Sus datos están protegidos</span>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <app-public-footer></app-public-footer>

  <!-- Loading Overlay -->
<div *ngIf="loading && showLoadingSteps" class="loading-overlay">
  <div class="loading-content">
    <div class="loading-spinner">
      <div class="spinner-circle"></div>
    </div>
    
    <h3>Creando su cuenta</h3>
    <p>Por favor espere mientras procesamos su registro...</p>
    
    <div class="loading-steps">
      <div class="loading-step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
        <div class="step-icon">
          <svg *ngIf="currentStep > 1" class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          <div *ngIf="currentStep <= 1" class="step-dot"></div>
        </div>
        <span>Validando información</span>
      </div>
      
      <div class="loading-step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
        <div class="step-icon">
          <svg *ngIf="currentStep > 2" class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          <div *ngIf="currentStep <= 2" class="step-dot"></div>
        </div>
        <span>Creando usuario</span>
      </div>
      
      <div class="loading-step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
        <div class="step-icon">
          <svg *ngIf="currentStep > 3" class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          <div *ngIf="currentStep <= 3" class="step-dot"></div>
        </div>
        <span>Enviando confirmación</span>
      </div>
    </div>
  </div>
</div>
</ng-container>

<!-- Vista para usuarios internos (simplificada) -->
<ng-container *ngIf="!isExternalUser">
  <div class="create-user-container">
    <div class="header-section">
      <h2>
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
          <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6z"/>
        </svg>
        Crear Usuario Interno
      </h2>
    </div>

    <!-- Alert Messages -->
    <div *ngIf="errorMessage" class="alert alert-error">
      <div class="alert-icon">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="alert-content">
        <h4>Error</h4>
        <p>{{ errorMessage }}</p>
      </div>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
      <div class="alert-icon">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="alert-content">
        <h4>¡Usuario creado!</h4>
        <p>{{ successMessage }}</p>
      </div>
    </div>

    <!-- Formulario interno simplificado -->
    <div class="form-card">
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <!-- Aquí puedes usar las mismas secciones pero agregando los campos específicos para usuarios internos -->
        <!-- Como idArea, idEmpresa, idRol -->
        
        <!-- Por brevedad, uso el mismo patrón pero con campos adicionales -->
        <!-- ... resto del formulario similar al externo pero con campos adicionales ... -->
        
        <div class="form-actions">
          <div class="action-buttons">
            <button type="button" class="btn btn-secondary" (click)="volver()">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
              Cancelar
            </button>
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="userForm.invalid || loading"
              [class.loading]="loading">
              <svg *ngIf="!loading" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              <svg *ngIf="loading" class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              {{ loading ? 'Creando...' : 'Crear Usuario' }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</ng-container>

<!-- Modal de Confirmación de Registro Exitoso -->
<div class="modal-overlay" *ngIf="showSuccessModal" (click)="closeSuccessModal()">
  <div class="success-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="success-icon">
        <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
      </div>
      <h2>¡Registro Exitoso!</h2>
      <p class="modal-subtitle">Su cuenta ha sido creada correctamente</p>
    </div>
    
    <div class="modal-body">
      <div class="user-info" *ngIf="registeredUserData">
        <div class="info-item">
          <span class="info-label">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
            Nombre:
          </span>
          <span class="info-value">{{ registeredUserData.nombre }}</span>
        </div>
        
        <div class="info-item">
          <span class="info-label">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
              <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
            </svg>
            Email:
          </span>
          <span class="info-value">{{ registeredUserData.email }}</span>
        </div>
        
        <div class="info-item">
          <span class="info-label">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
            Usuario:
          </span>
          <span class="info-value">{{ registeredUserData.username }}</span>
        </div>
        
        <div class="info-item">
          <span class="info-label">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z" clip-rule="evenodd"/>
            </svg>
            Documento:
          </span>
          <span class="info-value">{{ registeredUserData.tipoDocumento }} {{ registeredUserData.numeroDocumento }}</span>
        </div>
      </div>
      
      <!-- <div class="success-message">
        <div class="message-content">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002-2h12a2 2 0 002-2V8.118z"/>
          </svg>
          <div>
            <h4>Próximos pasos:</h4>
            <p *ngIf="isExternalUser">Se ha enviado un correo de confirmación a su dirección de email. Por favor, revise su bandeja de entrada y siga las instrucciones para activar su cuenta.</p>
            <p *ngIf="!isExternalUser">El usuario ha sido creado exitosamente y ya puede acceder al sistema con sus credenciales.</p>
          </div>
        </div>
      </div> -->
    </div>
    
    <div class="modal-footer">
      <button 
        *ngIf="isExternalUser" 
        type="button" 
        class="btn btn-primary"
        (click)="goToLogin()">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
        </svg>
        Ir al Login
      </button>
      
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="closeSuccessModal()">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
        {{ isExternalUser ? 'Cerrar' : 'Crear Otro Usuario' }}
      </button>
    </div>
  </div>
</div>